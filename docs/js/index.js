!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){window.Promise=TrelloPowerUp.Promise;var r=n(1),o=moment().toDate();const a=moment.tz.guess();var i=function(t,e,n,r){const o=n.commentFilter||"";if(!e)return new Promise.resolve(r);var i=t.getContext().card;return t.get("member","private","authToken").then((function(e){if(e){const c="bd1e7e486269d148ecd1be71ad5a3f1a";return axios.get(`https://api.trello.com/1/cards/${i}/actions?filter=commentCard&key=${c}&token=${e}`).then((function(e){const i=new Set;return e.data.forEach(t=>{const e=t.data.text.toUpperCase(),n=o.toUpperCase();if(e.includes(n)){const e=moment(t.date).tz(a).format("MM/DD/YYYY");i.add(e)}}),t.set("card","shared","habitTrackerSettings",{...n,commentDays:[...i]}).then(()=>(r.forEach(t=>i.add(t)),[...i]))})).catch((function(e){console.log("Error getting dates",e),t.set("member","private","authToken",void 0),t.set("card","shared","habitTrackerUseComments",!1)})).finally((function(){}))}t.set("member","private","authToken",void 0),t.set("card","shared","habitTrackerUseComments",!1)}))};TrelloPowerUp.initialize({"card-badges":function(t){return function(t){return t.get("card","shared").then((function(e){if(e.habitTrackerSettings&&e.habitTrackerSettings.daysInWeek)return i(t,e.habitTrackerUseComments,e.habitTrackerSettings,e.habitTrackerDays||[]).then(t=>{const n=parseInt(e.habitTrackerSettings.daysInWeek,10),i=e.habitTrackerSettings.firstDayOfWeek,c=moment(o).tz(a),s=moment(o).tz(a).subtract(1,"day"),u=r.getStreak(c,t,i,n),f=r.getStreak(s,t,i,n);return f>0&&f>u?[{text:`Streak: ${f}`,color:"yellow"}]:u>0?[{text:`Streak: ${u}`,color:"green"}]:[{text:"Streak: 0",color:"grey"}]})})).catch((function(t){return console.log("Error getting badge",t),[]}))}(t)},"card-buttons":function(t,e){return"write"!==e.context.permissions.board?[]:[{icon:`${window.location}img/icon.svg`,text:"Streak",callback:function(t){return t.popup({title:"Streak Settings",url:"./settings.html"})}}]},"card-back-section":function(t,e){return t.get("card","shared","habitTrackerSettings").then((function(e){if(e&&e.daysInWeek)return{title:"Streak",icon:`${window.location}img/icon.svg`,content:{type:"iframe",url:t.signUrl("./calendar.html"),height:280}}}))}},{appKey:"bd1e7e486269d148ecd1be71ad5a3f1a",appName:"Streak - habit tracker"})},function(t,e,n){var r=function(t,e){const n=moment.tz.guess();return"MONDAY"===t?moment(e,"MM/DD/YYYY",n).startOf("isoWeek"):moment(e,"MM/DD/YYYY",n).startOf("week")},o=function(t,e,n,o,i){const c=a(n,t),s=7-c.length;if(e.length>=o-s)return e.length;const u=c.length-(o-s);let f=moment(t,"MM/DD/YYYY");const d=r(n,t);let l=0,m=0;for(;f.isAfter(d)&&l<=u;)e.indexOf(f.format("MM/DD/YYYY"))>=0?m+=1:l+=1,f.subtract(1,"d");return m},a=function(t,e){const n=r(t,e);return i(n,e)},i=function(t,e){let n=[];for(var r=t;moment(r,"MM/DD/YYYY").isSameOrBefore(e,"day");)n.push(r.format("MM/DD/YYYY")),r.add(1,"d");return r.add(1,"d"),n};e.getStreak=function(t,e,n,r){const i=t.format("MM/DD/YYYY");if(0===r){return e.filter(e=>!moment(e,"MM/DD/YYYY").isAfter(t)).length}if(!(e.indexOf(i)>=0)&&7===r)return 0;const c=a(n,t),s=e.filter(t=>-1!==c.indexOf(t)),u=7-c.length;if(s.length>=r-u){const t=s.length;let i=moment(c[0],"MM/DD/YYYY").subtract(1,"day"),u=t,f=!0;for(;f;){const t=a(n,i),c=e.filter(e=>-1!==t.indexOf(e)),s=o(i,c,n,r);u+=s,f=s>=r,i=i.subtract(7,"day")}return u}return o(moment(t,"MM/DD/YYYY"),s,n,r)},e.getStreakForWeek=o,e.calendarDatesThisWeek=a,e.calendarDatesInWeek=function(t,e){const n=r(t,e);return i(n,moment(n,"MM/DD/YYYY").add(6,"d"))},e.getDatesInRange=i}]);